<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booklegging Entry Form</title>
    <!-- Chosen Palette: Soft Blues, Grays, and White for a clean, harmonious look. -->
    <!-- Application Structure Plan: The form is structured into thematic sections mirroring the image: "Booklogger Information," "School Selection," "Presentation Details," and a "Dynamic Book List." This logical grouping enhances usability by organizing related inputs. Each main section is contained within a card-like div with a soft blue background, providing clear visual separation. The dynamic book list is the core interactive component, allowing flexible data entry for multiple books within a single submission. This structure prioritizes intuitive user flow and easy content consumption. -->
    <!-- Visualization & Content Choices: For "Booklogger," "School," and "Presentation" sections, standard text inputs, email inputs, date pickers, and dropdowns (select elements) are used (Goal: Inform/Collect). The "Books List" uses a dynamic table (HTML table + JS for row addition) to facilitate structured, repeatable data entry (Goal: Organize/Collect). An "Add new row" button enables dynamic interaction (Interaction). The info icon is a simple unicode character for clarity (Goal: Inform). All visual elements are built with HTML/CSS and styled using Tailwind, and JavaScript handles dynamic behavior, adhering to the NO SVG/Mermaid constraints. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 - very light gray background */
            color: #334155; /* slate-700 - default text color */
        }
        .form-section {
            background-color: #cfe0f1; /* light-blue-100 - very light blue for sections */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 2rem; /* p-8 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.05); /* subtle shadow */
        }
        input[type="text"],
        input[type="email"],
        input[type="date"],
        select {
            display: block;
            width: 100%;
            padding: 0.625rem 0.875rem; /* px-3.5 py-2.5 */
            border: 1px solid #cbd5e1; /* slate-300 */
            border-radius: 0.375rem; /* rounded-md */
            background-color: #ffffff; /* white background for inputs */
            font-size: 1rem;
            line-height: 1.5rem;
            color: #334155; /* slate-700 */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            -webkit-appearance: none; /* Remove default styling for select on WebKit */
            -moz-appearance: none;    /* Remove default styling for select on Mozilla */
            appearance: none;         /* Remove default styling for select */
        }
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); /* blue-600 with opacity */
        }
        /* Custom arrow for select dropdowns */
        .select-wrapper {
            position: relative;
        }
        .select-wrapper::after {
            content: 'â–¼'; /* Unicode down arrow */
            position: absolute;
            right: 0.875rem; /* Equivalent to px-3.5 */
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #64748b; /* slate-500 */
            font-size: 0.75rem;
        }

        /* Styles for the dynamic book list table */
        #booksTable {
        /* Add this line */
        table-layout: fixed; /* Forces column widths to be respected */
        }


        /* Styles for the dynamic book list table */
       #booksTable th,
#booksTable td {
    padding: 0.75rem 1rem; /* p-3 px-4 */
    text-align: left;
    border-bottom: 1px solid #e2e8f0; /* slate-200 */
    word-wrap: break-word; /* Allows long words to break */
    white-space: normal; /* Ensures text wraps normally, not on a single line */
    /* Add overflow hidden to prevent content from spilling out if it can't wrap */
    overflow: hidden;
    word-break: break-all; /* Breaks words at any character if too long */
}
#booksTable textarea {
    width: 100%;
    height: auto; /* Allow height to adjust based on content */
    min-height: 40px; /* Or whatever makes sense for a single line */
    resize: vertical; /* Allow vertical resizing by user, or 'none' to disable */
    overflow: auto; /* Add scrollbars if content exceeds height */
    box-sizing: border-box;
    word-wrap: break-word; /* Important for long words */
    white-space: pre-wrap; /* Preserve spaces and wrap */
    background-color: #f8fafc; /* For consistency */
    border: 1px solid #cbd5e1; /* For consistency */
    border-radius: 0.375rem; /* For consistency */
    padding: 0.625rem 0.875rem; /* For consistency */
    font-size: 1rem;
    line-height: 1.5rem;
    color: #334155;
        /* Crucial for text wrapping *within* the textarea */
    white-space: pre-wrap; /* Preserves whitespace and wraps text */
    word-wrap: break-word; /* Breaks long words if necessary */
}
#booksTable textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
}
/* Explicit column widths for better control with table-layout: fixed */
#booksTable th:nth-child(1),
#booksTable td:nth-child(1) { /* Call no. */
    width: 20%; /* Adjust as needed */
    min-width: 100px; /* Minimum useful width */
}

#booksTable th:nth-child(2),
#booksTable td:nth-child(2) { /* Author */
    width: 30%; /* Adjust as needed */
    min-width: 150px;
}

#booksTable th:nth-child(3),
#booksTable td:nth-child(3) { /* Title */
    width: 45%; /* Adjust as needed */
    min-width: 200px;
}

#booksTable th:nth-child(4),
#booksTable td:nth-child(4) { /* Delete button */
    width: 5%; /* Keep small */
    min-width: 40px; /* Smallest sensible width */
}

#booksTable thead th {
    background-color: #f1f5f9; /* slate-100 */
    color: #475569; /* slate-600 */
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.875rem;
    letter-spacing: 0.05em;
}
#booksTable tbody tr:last-child td {
    border-bottom: none; /* No border for the last row */
}
#booksTable input[type="textarea"] {
    background-color: #f8fafc; /* slate-50 for table inputs */
    /* Ensure inputs take full width of their (now fixed) parent cell */
    width: 100%;
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
}
#booksTable tbody tr:nth-child(odd) {
     background-color: #ffffff; /* white */
}
#booksTable tbody tr:nth-child(even) {
    background-color: #f8fafc; /* slate-50 */
}

        .submit-button {
            display: block;
            width: fit-content;
            margin: 2.5rem auto 0; /* mt-10, centered */
            padding: 0.75rem 2rem; /* py-3 px-8 */
            background-color: #2563eb; /* blue-600 */
            color: #ffffff;
            border: none;
            border-radius: 0.5rem; /* rounded-lg */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .submit-button:hover {
            background-color: #1d4ed8; /* blue-700 */
            transform: translateY(-2px);
        }
        .submit-button:active {
            background-color: #1e40af; /* blue-800 */
            transform: translateY(0);
        }
        .submit-button:disabled {
            background-color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .info-icon {
            display: inline-block;
            font-size: 1.25rem; /* text-xl */
            margin-right: 0.5rem; /* mr-2 */
            color: #60a5fa; /* blue-400 */
            vertical-align: middle;
        }
        /* Styles for the header from the image */
    .app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background-color: #ffffff;
        border-bottom: 1px solid #e2e8f0;
        margin-bottom: 2rem; /* Added margin to separate from the main content */
    }

    .app-header-left {
        font-weight: 600;
        color: #1e293b; /* slate-800 */
        font-size: 1.125rem; /* text-lg */
    }

    .app-header-right {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    .app-header-right a {
        color: #475569; /* slate-600 */
        font-weight: 500;
        text-decoration: none;
        position: relative;
        padding-bottom: 0.25rem;
        transition: color 0.2s ease-in-out;
    }

    .app-header-right a:hover {
        color: #1e293b; /* slate-800 */
    }

    .app-header-right a.active {
        color: #2563eb; /* blue-600 */
    }

    .app-header-right a.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: #2563eb; /* blue-600 */
    }

    .search-icon {
        font-size: 1.25rem;
        color: #475569; /* slate-600 */
        cursor: pointer;
    }

    .bookleggers-image {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 2rem auto; /* Center the image and add some margin */
    }
        /* Delete button styles */
        .delete-row-btn {
            background-color: #ffffff; /* red-500 */
            color: #757575;
            border: 1px solid #ccc;
            border-radius: 1rem; /* rounded-sm */
            padding: 0.25rem 0.5rem; /* py-1 px-2 */
            font-size: 1rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            margin-left: 0.5rem; /* Space from input */
            line-height: 1; /* Align 'x' properly */
        }

        .delete-row-btn:hover {
            background-color: #cfe0f1; /* red-600 */
        }
        /* Styles for multi-select checkboxes */
    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); /* Responsive columns */
        gap: 0.75rem; /* gap-3 */
        margin-top: 0.5rem; /* mt-2 */
        padding: 0.625rem 0.875rem; /* px-3.5 py-2.5 - consistent with input padding */
        border: 1px solid #cbd5e1; /* slate-300 */
        border-radius: 0.375rem; /* rounded-md */
        background-color: #ffffff; /* white background */
    }

    .checkbox-group label {
        display: flex;
        align-items: center;
        font-size: 0.95rem; /* text-sm */
        color: #334155; /* slate-700 */
        cursor: pointer;
    }

    .checkbox-group input[type="checkbox"] {
        -webkit-appearance: initial; /* Revert default appearance for checkboxes */
        -moz-appearance: initial;
        appearance: initial;
        width: 1rem; /* size of checkbox */
        height: 1rem;
        margin-right: 0.5rem; /* mr-2 */
        border: 1px solid #94a3b8; /* slate-400 */
        border-radius: 0.25rem; /* rounded-sm */
        background-color: #ffffff;
        transition: all 0.15s ease-in-out;
        cursor: pointer;
        display: inline-block; /* Ensure it respects width/height */
    }

    .checkbox-group input[type="checkbox"]:checked {
        background-color: #2563eb; /* blue-600 */
        border-color: #2563eb; /* blue-600 */
    }

    .checkbox-group input[type="checkbox"]:checked::after {
        content: 'âœ”'; /* Checkmark for checked state */
        display: block;
        color: white;
        font-size: 0.75rem;
        line-height: 1;
        text-align: center;
        position: relative;
        top: 1px;
        left: 1px;
    }

    .checkbox-group input[type="checkbox"]:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); /* blue-600 with opacity */
    }
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 90%;
            width: 600px; /* Max width for the modal */
            animation: fadeIn 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-body textarea {
            min-height: 150px; /* Ensure enough space for pasting multiple lines */
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .hidden {
            display: none;
        }
        
       /* Message box styles */
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }

        .message-box.show {
            opacity: 1;
        }

        .message-box.success {
            background-color: #22c55e; /* green-500 */
        }

        .message-box.error {
            background-color: #ef4444; /* red-500 */
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
<!--<img src="booklegger image.jpeg" alt="Fremont Bookleggers walking books" class="bookleggers-image">-->
    <div class="app-header">
    <div class="app-header-left">
        Fremont Bookleggers
    </div>
    <div class="app-header-right">
        <a href="https://sites.google.com/view/fremont-bookleggers/home?authuser=0">Home</a>
        <a href="https://sites.google.com/view/fremont-bookleggers/for-bookleggers?authuser=0" class="active">For Bookleggers</a>
        <a href="https://sites.google.com/view/fremont-bookleggers/for-librarians?authuser=0">For Librarians</a>
        <a href="submit_participation.html">Submit your participation</a>
        <a href="schedule_booklegging.html">Schedule your booklegger visit</a>
    </div>
        
</div>
  <div class="app-header">  <img src="booklegger image.jpeg" alt="Fremont Bookleggers walking books" class="bookleggers-image"></div>

    <div class="max-w-4xl mx-auto space-y-8">
        <!-- Main Page Title and Description -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-900 mb-2">Booklegger Presentation List</h1>
            <p class="text-md sm:text-lg text-slate-600">Please submit the list of books that you presented during your Booklegger visit. Each class should be submitted separately.</p>
        </header>
        <!--<img src="booklegger image.jpeg" alt="Fremont Bookleggers walking books" class="bookleggers-image">-->
        <!-- Section 1: Booklegger Information -->
        <section class="form-section">
            <h3 class="text-xl font-semibold text-slate-800 mb-6">Booklegger information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-8">
                <div>
                    <label for="name" class="block text-sm font-medium text-slate-700 mb-2">Name</label>
                    <input type="text" id="name" name="bookloggerName" placeholder="Enter your full name" required>
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                    <input type="email" id="email" name="bookloggerEmail" placeholder="you@example.com" required>
                </div>
                <!--<div class="md:col-span-2">
                    <label for="contact" class="block text-sm font-medium text-slate-700 mb-2">Contact</label>
                    <input type="text" id="contact" name="bookloggerContact" placeholder="Phone or preferred contact method" required>
                </div>-->
            </div>
        </section>

        <!-- Section 2: Select School -->
        <section class="form-section">
            <h3 class="text-xl font-semibold text-slate-800 mb-6">Select school where you Booklegged</h3>
            <div class="select-wrapper max-w-sm">
                <label for="school" class="sr-only">Select school</label>
                <select id="school" name="schoolName" required>
                    <option value="">Select school</option>
                    <option value="Ardenwood">Ardenwood</option>
                    <option value="Azevada">Azevada</option>
                    <option value="Blacow">Blacow</option>
                    <option value="Brier">Brier</option>
                    <option value="Bringhurst">Bringhurst</option>
                    <option value="Brookvale">Brookvale</option>
                    <option value="Cabrillo">Cabrillo</option>
                    <option value="Chadbourne">Chadbourne</option>
                    <option value="Durham">Durham</option>
                    <option value="Forest Park">Forest Park</option>
                    <option value="Glenmoor">Glenmoor</option>
                    <option value="Gomes">Gomes</option>
                    <option value="Green">Green</option>
                    <option value="Grimmer">Grimmer</option>
                    <option value="Hirsch">Hirsch</option>
                    <option value="Leitch">Leitch</option>
                    <option value="Maloney">Maloney</option>
                    <option value="Mattos">Mattos</option>
                    <option value="Millard">Millard</option>
                    <option value="MSJE">MSJE</option>
                    <option value="Mission Valle">Mission Valley</option>
                    <option value="Niles">Niles</option>
                    <option value="Oliveira">Oliveira</option>
                    <option value="Parkmont">Parkmont</option>
                    <option value="Patterson">Patterson</option>
                    <option value="Vallejo Mill">Vallejo Mill</option>
                    <option value="Warm Springs">Warm Springs</option>
                    <option value="Warwick">Warwick</option>
                    <option value="Weibel">Weibel</option>
                </select>
            </div>
            <!--<p class="mt-4 text-sm text-blue-600 hover:text-blue-800">
                <a href="https://fremontunified.org/about/schools/" class="inline-flex items-center">Click here to check school directory</a>
            </p>-->
        </section>

        <!-- Section 3: Presentation Information -->
        <section class="form-section">
            <h3 class="text-xl font-semibold text-slate-800 mb-6">Presentation information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-8">
                <div>
                    <label for="presentationDate" class="block text-sm font-medium text-slate-700 mb-2">Presentation date</label>
                    <input type="date" id="presentationDate" name="presentationDate" placeholder="mm/dd/yyyy" required>
                </div>
                <div>
                    <label for="teacherName" class="block text-sm font-medium text-slate-700 mb-2">Teacher's name</label>
                    <input type="text" id="teacherName" name="teacherName" placeholder="Enter teacher's name" required>
                </div>
                 <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Select grade(s)</label>
                    <div id="gradeCheckboxes" class="checkbox-group">
                        <!--<label><input type="checkbox" name="gradeLevel" value="Kindergarten"> Kindergarten</label>-->
                        <!--<label><input type="checkbox" name="gradeLevel" value="1st Grade"> 1st Grade</label>-->
                        <label><input type="checkbox" name="gradeLevel" value="2"> 2</label>
                        <label><input type="checkbox" name="gradeLevel" value="3"> 3</label>
                        <label><input type="checkbox" name="gradeLevel" value="4"> 4</label>
                        <label><input type="checkbox" name="gradeLevel" value="5"> 5</label>
                        <!--<label><input type="checkbox" name="gradeLevel" value="6th Grade"> 6th Grade</label>-->
                        <label><input type="checkbox" name="gradeLevel" value="SDC"> SDC</label>
                        <label><input type="checkbox" name="gradeLevel" value="Other"> Other</label>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Dynamic List of Books -->
        <section>
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-slate-800">
                    Enter the list of books you presented
                </h3>
                <div class="flex space-x-2"> <!-- Container for multiple buttons -->
                    <button type="button" id="pasteFromSpreadsheetBtn" class="flex items-center px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-medium text-sm rounded-md shadow-sm transition-colors duration-200">
                        Paste from Spreadsheet
                    </button>
                    <button type="button" id="addNewRowBtn" class="flex items-center px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium text-sm rounded-md shadow-sm transition-colors duration-200">
                    <span class="text-xl mr-1">+</span> Add new row
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg shadow-sm border border-slate-200">
                <table id="booksTable" class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th>Call no.</th>
                            <th>Author</th>
                            <th>Title</th>
                            <th class="w-10"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Initial row for book entry -->
                        <!--<tr class="book-row">
                            <td><input type="text" name="callNo_0" placeholder="e.g., QC173.4" required></td>
                            <td><input type="text" name="author_0" placeholder="e.g., Lisa Randall" required></td>
                            <td><input type="text" name="title_0" placeholder="e.g., Warped Passages" required></td>
                            <!--<td><button type="button" class="delete-row-btn">x</button></td>
                        </tr>-->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" id="mainSubmitBtn" class="submit-button">Submit</button>
        </div>
    </div>

    <!-- Message box for user feedback -->
    <div id="messageBox" class="message-box"></div>

    <!-- Custom Modal for Paste from Spreadsheet -->
    <div id="pasteModalOverlay" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="text-xl font-semibold">Paste Spreadsheet Data</h4>
                <button type="button" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="text-slate-700 mb-2">Copy data from your spreadsheet and paste here. The data in the spreadsheet should be in the same order: callno. author and title</p>
                <textarea id="pasteTextArea" rows="10" class="w-full p-2 border rounded-md font-mono text-sm"></textarea>
                <p class="text-sm text-slate-500 mt-2">Example:</p>
                <pre class="bg-slate-100 p-2 rounded-md text-sm text-slate-700">QC173.4	Lisa Randall	Warped Passages</pre>
            </div>
            <div class="modal-footer">
                <button type="button" id="modalCancelBtn" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-md text-gray-800 font-medium">Cancel</button>
                <button type="button" id="modalOkBtn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md font-medium">Paste</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded fired.');
            const addNewRowBtn = document.getElementById('addNewRowBtn');
            const pasteFromSpreadsheetBtn = document.getElementById('pasteFromSpreadsheetBtn');
            const booksTableBody = document.querySelector('#booksTable tbody');
            const mainSubmitBtn = document.getElementById('mainSubmitBtn');
            const messageBox = document.getElementById('messageBox');
            const gradeCheckboxesContainer = document.getElementById('gradeCheckboxes');

            // New modal element references
            const pasteModalOverlay = document.getElementById('pasteModalOverlay');
            const pasteTextArea = document.getElementById('pasteTextArea');
            const modalOkBtn = document.getElementById('modalOkBtn');
            const modalCancelBtn = document.getElementById('modalCancelBtn');
            const modalCloseBtn = document.querySelector('#pasteModalOverlay .modal-close-btn');

            // Log if key elements are found
            console.log('pasteFromSpreadsheetBtn:', pasteFromSpreadsheetBtn);
            console.log('pasteModalOverlay:', pasteModalOverlay);
            console.log('pasteTextArea:', pasteTextArea);
            console.log('modalOkBtn:', modalOkBtn);
            console.log('modalCancelBtn:', modalCancelBtn);
            console.log('modalCloseBtn:', modalCloseBtn);
            console.log('booksTableBody:', booksTableBody);
            
            let rowCount = 0; // Start at 1 because one row is already present in HTML

            // Function to add a new row to the books table
            function addNewBookRow(callNo = '', author = '', title = '') {
                console.log('addNewBookRow called with:', { callNo, author, title, current_rowCount: rowCount });
                const newRow = document.createElement('tr');
                newRow.className = 'book-row';
                // Create table data cells
                const tdCallNo = document.createElement('td');
                const inputCallNo = document.createElement('input');
                inputCallNo.type = 'text';
                inputCallNo.name = `callNo_${rowCount}`; // Use dynamic name
                //inputCallNo.placeholder = 'e.g., QC173.4';
                inputCallNo.value = callNo; // Set value directly
                inputCallNo.required = true;
                inputCallNo.className = 'block w-full px-3.5 py-2.5 border border-slate-300 rounded-md bg-white font-size-1rem line-height-1.5rem text-slate-700'; // Apply Tailwind classes
                tdCallNo.appendChild(inputCallNo);
                newRow.appendChild(tdCallNo);

                const tdAuthor = document.createElement('td');
                const textareaAuthor = document.createElement('textarea'); // <--- CRITICAL CHANGE: Create a <textarea> element
                textareaAuthor.name = `author_${rowCount}`;
                textareaAuthor.value = author;
                textareaAuthor.required = true;
                textareaAuthor.rows = 1; // <--- Set initial rows. We'll use JS/CSS for auto-resize.
                textareaAuthor.className = 'block w-full px-3.5 py-2.5 border border-slate-300 rounded-md bg-white font-size-1rem line-height-1.5rem text-slate-700'; // Apply your existing classes
                tdAuthor.appendChild(textareaAuthor);
                newRow.appendChild(tdAuthor);


                // --- Title Field (CHANGE TO TEXTAREA) ---
                const tdTitle = document.createElement('td');
                const textareaTitle = document.createElement('textarea'); // <--- CRITICAL CHANGE: Create a <textarea> element
                textareaTitle.name = `title_${rowCount}`;
                textareaTitle.value = title;
                textareaTitle.required = true;
                textareaTitle.rows = 1; // <--- Set initial rows.
                textareaTitle.className = 'block w-full px-3.5 py-2.5 border border-slate-300 rounded-md bg-white font-size-1rem line-height-1.5rem text-slate-700'; // Apply your existing classes
                tdTitle.appendChild(textareaTitle);
                newRow.appendChild(tdTitle);

                const tdDelete = document.createElement('td');
                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'delete-row-btn'; // Apply existing CSS class
                deleteButton.textContent = 'X';
                deleteButton.addEventListener('click', deleteBookRow);
                tdDelete.appendChild(deleteButton);
                newRow.appendChild(tdDelete);

                if (booksTableBody) {
                    booksTableBody.appendChild(newRow);
                    console.log('New row appended to booksTableBody. Current tbody child count:', booksTableBody.children.length);
                    function autoResizeTextarea(textareaElement) {
                        textareaElement.style.height = 'auto'; // Reset height to recalculate
                        textareaElement.style.height = textareaElement.scrollHeight + 'px'; // Set to scroll height
                    }

                    // Add event listeners to trigger auto-resize when user types
                    textareaAuthor.addEventListener('input', () => autoResizeTextarea(textareaAuthor));
                    textareaTitle.addEventListener('input', () => autoResizeTextarea(textareaTitle));

                     // Trigger auto-resize once immediately if there's pre-filled data (e.g., from pasting)
                    // This ensures they are sized correctly on initial load/paste.
                    if (author) autoResizeTextarea(textareaAuthor);
                    if (title) autoResizeTextarea(textareaTitle);
                   // After appending, check the input/textarea element's value property directly
                    const addedCallNoInput = newRow.querySelector(`input[name="callNo_${rowCount}"]`);
                    if (addedCallNoInput) {
                        console.log(`Value property of callNo_${rowCount} after append:`, addedCallNoInput.value);
                    }
                    const addedAuthorTextarea = newRow.querySelector(`textarea[name="author_${rowCount}"]`);
                    if (addedAuthorTextarea) {
                        console.log(`Value property of author_${rowCount} after append:`, addedAuthorTextarea.value);
                    }
                } else {
                    console.error('booksTableBody is null! Cannot append new row.');
                    showMessage('Error: Table body not found, cannot add rows.', 'error');
                }
                //newRow.innerHTML = `
                   // <td><input type="text" name="callNo_${rowCount}" placeholder="e.g., QC173.4"></td>
                   // <td><input type="text" name="author_${rowCount}" placeholder="e.g., Lisa Randall"></td>
                   // <td><input type="text" name="title_${rowCount}" placeholder="e.g., Warped Passages"></td>
                   // <td><button type="button" class="delete-row-btn">x</button></td>
                //`;
               // booksTableBody.appendChild(newRow);
                rowCount++;
                // Add event listener to the new delete button
                //newRow.querySelector('.delete-row-btn').addEventListener('click', deleteBookRow);
            }
             // Function to delete a row from the books table
            function deleteBookRow(event) {
                const rowToDelete = event.target.closest('.book-row');
                if (rowToDelete) {
                    // Ensure at least one row remains
                    if (booksTableBody.querySelectorAll('.book-row').length > 1) {
                        rowToDelete.remove();
                    } else {
                        showMessage('Cannot delete the last row.', 'error');
                    }
                }
            }
            
// Function to show the modal and return a Promise with its result
            function showPasteModal() {
                console.log('showPasteModal called.'); // Confirm function call
                if (pasteModalOverlay && pasteTextArea) { // Check both modal overlay and textarea
                    pasteTextArea.value = ''; // Clear previous content
                    pasteModalOverlay.classList.remove('hidden'); // Show the modal
                    console.log('Modal display changed to block.');
                    pasteTextArea.focus(); // Set focus to the textarea for immediate pasting
                } else {
                    console.error('Modal overlay or textarea element not found!');
                    showMessage('Error: Paste modal components not found. Please refresh.', 'error');
                    return Promise.resolve(null); // Resolve immediately with null if modal missing
                }
                
                return new Promise((resolve) => {
                    pasteTextArea.value = ''; // Clear previous content
                    pasteModalOverlay.classList.remove('hidden');

                    const handleOk = () => {
                        pasteModalOverlay.classList.add('hidden');
                        resolve(pasteTextArea.value);
                        removeListeners();
                    };

                    const handleCancel = () => {
                        pasteModalOverlay.classList.add('hidden');
                        resolve(null); // Resolve with null if cancelled
                        removeListeners();
                    };

                    // Add event listeners for modal buttons
                    modalOkBtn.addEventListener('click', handleOk);
                    modalCancelBtn.addEventListener('click', handleCancel);
                    modalCloseBtn.addEventListener('click', handleCancel); // Close button also cancels

                    // Function to remove event listeners to prevent duplicates
                    const removeListeners = () => {
                        modalOkBtn.removeEventListener('click', handleOk);
                        modalCancelBtn.removeEventListener('click', handleCancel);
                        modalCloseBtn.removeEventListener('click', handleCancel);
                    };
                });
            }

               // Function to process pasted data and add rows
            async function processPastedData() {
                const pastedText = await showPasteModal();
                if (pastedText) {
                    const lines = pastedText.split('\n').filter(line => line.trim() !== '');
                    if (lines.length > 0) {
                        // Clear existing rows only if new data is pasted
                        while (booksTableBody.firstChild) {
                            booksTableBody.removeChild(booksTableBody.firstChild);
                        }
                        rowCount = 0; // Reset rowCount as we are repopulating
                    }

                    lines.forEach(line => {
                        // Split by tab for spreadsheet data, or by multiple spaces as a fallback
                        const columns = line.split('\t').map(col => col.trim()); // Assuming tab-separated values
                        if (columns.length >= 3) {
                            addNewBookRow(columns[0], columns[1], columns[2]);
                        } else if (columns.length > 0) {
                            // Handle cases where fewer than 3 columns might be present
                            addNewBookRow(columns[0] || '', columns[1] || '', columns[2] || '');
                        }
                    });
                    showMessage('Book data pasted successfully!', 'success');
                } else {
                    showMessage('Pasting cancelled or no data entered.', 'error');
                }
            }


            // Modified pasteDataFromSpreadsheet function to use the custom modal
              async function pasteDataFromSpreadsheet() {
                  console.log('pasteDataFromSpreadsheet called.');
                try {
                    const pastedData = await showPasteModal(); // Await the modal's result

                    if (pastedData === null || pastedData.trim() === '') {
                        showMessage('No data pasted or operation cancelled.', 'info');
                        return;
                    }

                 
// Normalize newline characters to handle data copied from different OS (e.g., Windows \r\n vs Unix \n)
                    const normalizedData = pastedData.replace(/\r/g, ''); // Remove carriage returns
                    console.log('Normalized data (after \\r removal):', normalizedData);

                    const rows = normalizedData.trim().split('\n');
                    console.log('Split into rows:', rows);
                    
                    // Clear all existing book rows before pasting
                    while (booksTableBody.querySelectorAll('.book-row').length > 0) {
                        booksTableBody.querySelector('.book-row').remove();
                    }
                    rowCount = 0; // Reset rowCount after clearing all rows
                    console.log('Existing rows cleared, rowCount reset to 0.');

                    rows.forEach(rowString => {
                         // Skip empty lines that might result from extra newlines after trim()
                        if (rowString.trim() === '') {
                            console.log('Skipping empty row string.');
                            return;
                        }
                        const columns = rowString.split(/[\t]+|\s{2,}/); // Assuming tab-separated values
                        console.log(`Processing row: "${rowString}" -> Columns:`, columns);
                        // Ensure we have at least 3 columns (Call No, Author, Title)
                        const callNo = columns[0] ? columns[0].trim() : '';
                        const author = columns[1] ? columns[1].trim() : '';
                        const title = columns[2] ? columns[2].trim() : '';

                        // Add new row with pasted data
                        if (callNo || author || title) {
                            addNewBookRow(callNo, author, title);
                            dataAdded = true;
                            console.log(`Added row successfully: CallNo="${callNo}", Author="${author}", Title="${title}"`);
                        } else {
                            console.log('Skipping line with no content after parsing:', rowString);
                        }
                    });

                    // If no data was pasted or all pasted rows were empty, add one back
                    if (!dataAdded && booksTableBody.querySelectorAll('.book-row').length === 0) {
                        addNewBookRow(); // Add an empty row if no data was pasted and table was cleared
                        console.log('No data was pasted, added back one empty row.');
                        
                    }

                    showMessage('Data pasted successfully!', 'success');

                } catch (error) {
                    console.error('Error pasting data:', error);
                    showMessage('Failed to paste data. Please ensure it is correctly formatted.', 'error');
                }
            }
            
            // Function to clear all form fields and reset the book table
            function clearForm() {
                // Clear text, email, and date inputs
                document.querySelectorAll('input[type="text"], input[type="email"], input[type="date"]').forEach(input => {
                    input.value = '';
                    input.style.borderColor = ''; // Reset validation border
                });

                // Reset select dropdowns
                document.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0; // Set to the first option (usually "Select...")
                    select.style.borderColor = ''; // Reset validation border
                });

                // Uncheck all grade level checkboxes
                gradeCheckboxesContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                gradeCheckboxesContainer.style.borderColor = ''; // Reset validation border

                // Clear all dynamic book rows and add one empty row
                while (booksTableBody.querySelectorAll('.book-row').length > 0) {
                    booksTableBody.querySelector('.book-row').remove();
                }
                rowCount = 0; // Reset row count
                addNewBookRow(); // Add back one empty row

                showMessage('Form submitted successfully!', 'info');
            }

            // Event listener for "Paste from Spreadsheet" button
            //pasteFromSpreadsheetBtn.addEventListener('click', pasteDataFromSpreadsheet);

            // Event listener for "Paste from Spreadsheet" button
            //pasteFromSpreadsheetBtn.addEventListener('click', pasteDataFromSpreadsheet);

            // Event listener for "Add new row" button
            //addNewRowBtn.addEventListener('click', addNewBookRow);
            // Change it to this:
            addNewRowBtn.addEventListener('click', () => {
                addNewBookRow(); // Now addNewBookRow is called with no arguments (or you can pass explicit empty strings)
            });
             // Event listener for "Paste from Spreadsheet" button
            if (pasteFromSpreadsheetBtn) { // Ensure button exists before adding listener
                pasteFromSpreadsheetBtn.addEventListener('click', processPastedData);
            } else {
                console.error('Paste from Spreadsheet button not found!');
            }
            // IMPORTANT: Create the initial row using the function now
            // This ensures all rows are consistently created.
            // Removed the static <tr> from HTML and replaced with this:
            addNewBookRow();

             // Add event listeners to initial delete buttons (if any exist)
            booksTableBody.querySelectorAll('.delete-row-btn').forEach(button => {
                button.addEventListener('click', deleteBookRow);
            });

            // Event listener for the main form submission
            mainSubmitBtn.addEventListener('click', async (event) => {
                event.preventDefault(); // Prevent default form submission

                mainSubmitBtn.disabled = true;
                mainSubmitBtn.textContent = 'Submitting...';

                // Collect all form data
                const formData = {};
                //const formElements = document.querySelectorAll('input, select');
                const formElements = document.querySelectorAll('input:not([name^="gradeLevel"]):not(.book-row input), select'); // Exclude grade checkboxes and book row inputs for initial collection

                let allRequiredFieldsFilled = true;

                formElements.forEach(element => {
                    const name = element.name || element.id;
                    if (name) { // Ensure element has a name or ID
                        // Basic required validation and highlight
                        if (element.hasAttribute('required') && element.value.trim() === '') {
                            allRequiredFieldsFilled = false;
                            element.style.borderColor = '#ef4444'; // Red border
                        } else {
                            element.style.borderColor = ''; // Reset border
                        }
                        // Special handling for presentationDate to format it as MM/DD/YYYY
                        if (name === 'presentationDate' && element.value.trim() !== '') {
                            const date = new Date(element.value.trim()); // Parse YYYY-MM-DD
                            const month = (date.getMonth() + 1).toString().padStart(2, '0');
                            const day = date.getDate().toString().padStart(2, '0');
                            const year = date.getFullYear();
                            formData[name] = `${month}/${day}/${year}`; // Format as MM/DD/YYYY
                        } else {
                            formData[name] = element.value.trim();
                        }
                        // Collect value
                        //formData[name] = element.value.trim();
                    }
                });

                // Collect selected grades from checkboxes
                const selectedGrades = [];
                const gradeCheckboxes = gradeCheckboxesContainer.querySelectorAll('input[name="gradeLevel"]:checked');
                if (gradeCheckboxes.length === 0) {
                    allRequiredFieldsFilled = false;
                    gradeCheckboxesContainer.style.borderColor = '#ef4444'; // Highlight the container
                } else {
                    gradeCheckboxesContainer.style.borderColor = ''; // Reset border
                    gradeCheckboxes.forEach(checkbox => {
                        selectedGrades.push(checkbox.value);
                    });
                }
                formData.gradeLevel = selectedGrades; // Store grades as an array

                // Collect data from dynamically added book rows
                const booksData = [];
                const bookRows = booksTableBody.querySelectorAll('.book-row');
                bookRows.forEach((row, index) => {
                    const callNoInput = row.querySelector(`input[name="callNo_${index}"]`);
                    const authorInput = row.querySelector(`input[name="author_${index}"]`);
                    const titleInput = row.querySelector(`input[name="title_${index}"]`);

                    // Also check required for dynamic rows
                    // Note: This form's image example implies optional blank rows for books,
                    // but inputs have 'required'. This logic allows empty optional rows if inputs were not required.
                    // If all book fields *must* be filled for a row to be included, adjust this.
                    const isRowFilled = callNoInput.value.trim() || authorInput.value.trim() || titleInput.value.trim();

                    if (isRowFilled) {
                        if (callNoInput && callNoInput.hasAttribute('required') && callNoInput.value.trim() === '') {
                            allRequiredFieldsFilled = false;
                            callNoInput.style.borderColor = '#ef4444';
                        } else if (callNoInput) {
                            callNoInput.style.borderColor = '';
                        }

                        if (authorInput && authorInput.hasAttribute('required') && authorInput.value.trim() === '') {
                            allRequiredFieldsFilled = false;
                            authorInput.style.borderColor = '#ef4444';
                        } else if (authorInput) {
                            authorInput.style.borderColor = '';
                        }

                        if (titleInput && titleInput.hasAttribute('required') && titleInput.value.trim() === '') {
                            allRequiredFieldsFilled = false;
                            titleInput.style.borderColor = '#ef4444';
                        } else if (titleInput) {
                            titleInput.style.borderColor = '';
                        }

                        booksData.push({
                            callNo: callNoInput ? callNoInput.value.trim() : '',
                            author: authorInput ? authorInput.value.trim() : '',
                            title: titleInput ? titleInput.value.trim() : ''
                        });
                    }
                });

                formData.books = booksData; // Add books array to main form data

                if (!allRequiredFieldsFilled) {
                    showMessage('Please fill in all required fields.', 'error');
                    mainSubmitBtn.disabled = false;
                    mainSubmitBtn.textContent = 'Submit';
                    return;
                }

                // --- IMPORTANT: Google Apps Script Web App URL ---
                // You MUST replace 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE' with the actual URL
                // you get after deploying your Google Apps Script as a Web App (see instructions below).
                const gasWebAppUrl = 'https://script.google.com/macros/s/AKfycbwi32izjHYGgVyasys_symsHEBk6qo3HbRpvpx2DrzwwAl-823Bss9c5-7kOP6F-lvILA/exec'; // <<< Update this URL!
                if (gasWebAppUrl === '' || !gasWebAppUrl.startsWith('https://script.google.com/macros/')) {
                    showMessage('Error: Please deploy your Google Apps Script and update "gasWebAppUrl" in the HTML with the actual Web App URL.', 'error');
                    mainSubmitBtn.disabled = false;
                    mainSubmitBtn.textContent = 'Submit';
                    return;
                }

                try {
                    const response = await fetch(gasWebAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData), // Send the entire formData object
                        mode: 'no-cors' // Required for simple POST requests to GAS from different origins
                    });

                    showMessage('Form data sent for submission. Check your Google Sheet!', 'success');
                    // Consider form.reset() here if you want to clear the form after submission
                     clearForm(); // Uncomment this line if you want the form to reset
                    
                } catch (error) {
                    console.error('Error sending data to Google Apps Script:', error);
                    showMessage('An error occurred while submitting data. Please try again.', 'error');
                } finally {
                    mainSubmitBtn.disabled = false; // Always re-enable button
                    mainSubmitBtn.textContent = 'Submit'; // Reset text
                }
            });

            // Function to display messages (reused from previous examples)
            function showMessage(message, type = 'success') {
                messageBox.textContent = message;
                messageBox.className = `message-box show ${type}`;
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>
</html>

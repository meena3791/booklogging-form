<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booklegger Participation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 400px;
            position: relative;
        }
        .modal-close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568; /* gray-700 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        /* Hidden by default, shown by JavaScript */
        #availabilitySection, #continueBookloggingSection,
        #continueBookloggingYesMessage, #continueBookloggingNoMessage, #submissionSuccessMessage, #submissionErrorMessage {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8">

    <!-- Top Navigation Bar -->
    <header class="w-full bg-white shadow-sm py-4 px-6 flex justify-between items-center fixed top-0 z-10">
        <div class="flex items-center space-x-2">
            <!--<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001 1h3v-9a1 1 0 011-1h2a1 1 0 011 1v9h3a1 1 0 001-1v-9m-9 0h.01"></path>
            </svg>-->
            <a href="https://sites.google.com/view/fremont-bookleggers/home?authuser=0" class="text-gray-700 hover:underline">Home</a>
        </div>
        <nav class="flex items-center space-x-6">
            <a href="https://sites.google.com/view/fremont-bookleggers/for-bookleggers?authuser=0" class="text-gray-700 hover:underline">For Booklegger</a>
            <a href="https://sites.google.com/view/fremont-bookleggers/for-librarians?authuser=0" class="text-blue-600 hover:underline font-medium">For Librarian</a>
            <a href="index.html" class="text-gray-700 hover:underline">Submit books presented</a>-->
            <!--<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>-->
        </nav>
    </header>

    <!-- Main Content Area -->
    <div class="container mx-auto mt-20 px-4 max-w-4xl">

        <!-- Booklegger Logo and Search -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8 flex flex-col md:flex-row items-center justify-between">
            <img src="booklegger image.jpeg" alt="Booklegger Logo" class="mb-4 md:mb-0 md:mr-6 rounded-lg">
            <div class="flex items-center border border-gray-300 rounded-md overflow-hidden w-full md:w-auto">
                <input type="text" placeholder="Search here" class="px-4 py-2 flex-grow focus:outline-none text-gray-700">
                <button class="bg-gray-100 p-2 border-l border-gray-300 hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Submit your participation Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="flex items-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <h2 class="text-2xl font-semibold text-gray-800">Submit your participation</h2>
            </div>
            <p id="availabilityPrompt" class="text-blue-600 hover:underline">Please mark your availability for your next booklegging event.</p>
        </div>

        <!-- Back Button -->
        <div class="mb-6">
            <a href="#" id="backLink" class="text-blue-600 hover:underline flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back
            </a>
        </div>

        <!-- Booklegger Information Form -->
        <div id="bookloggerInfoForm" class="bg-blue-50 p-6 rounded-lg shadow-md mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Booklegger information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-center">
                    <label for="name" class="w-24 text-gray-700">Name</label>
                    <input type="text" id="name" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div class="flex items-center">
                    <label for="email" class="w-24 text-gray-700">Email</label>
                    <input type="email" id="email" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
            </div>
        </div>

        <!-- Decision Message -->
        <p class="text-gray-600 mb-8">If you want more time to make a decision, record your submission later.</p>

        <!-- Are you booklogging next semester? -->
        <div class="bg-blue-50 p-6 rounded-lg shadow-md mb-8 flex flex-col items-start">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Are you booklegging next semester?</h3>
            <div class="flex items-center space-x-6 mb-4">
                <label class="inline-flex items-center">
                    <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="bookloggingNextSemester" value="yes" id="radioYes">
                    <span class="ml-2 text-gray-700">Yes</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="bookloggingNextSemester" value="no" id="radioNo">
                    <span class="ml-2 text-gray-700">No</span>
                </label>
            </div>
            <!--<div class="self-end">
                <button class="text-blue-600 hover:underline">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </button>
            </div>-->
        </div>

        <!-- Section: Select your availability and grades you'd like to bookleg -->
        <div id="availabilitySection" class="bg-blue-50 p-6 rounded-lg shadow-md mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Select your availability and grades you'd like to bookleg</h3>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Select your grade preference</label>
                <div class="flex flex-wrap gap-4">
                    <label class="inline-flex items-center">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" value="2">
                        <span class="ml-2 text-gray-700">2</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" value="3">
                        <span class="ml-2 text-gray-700">3</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" value="4">
                        <span class="ml-2 text-gray-700">4</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" value="5">
                        <span class="ml-2 text-gray-700">5</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" value="Other">
                        <span class="ml-2 text-gray-700">Other</span>
                    </label>
                </div>
            </div>

            <div class="mb-4 flex items-center">
                <label for="numClasses" class="w-32 text-gray-700">No. of classess</label>
                <select id="numClasses" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <option value="">Select no. of classes</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="More than 5">More than 5</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="additionalComments" class="block text-gray-700 text-sm font-bold mb-2 flex items-center">
                    Additional comments
                    <svg id="infoIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-600 ml-2 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </label>
                <textarea id="additionalComments" rows="4" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
            </div>

            <div class="text-center mt-6">
                <button id="submitAvailabilityBtn" class="bg-blue-600 text-white px-8 py-3 rounded-md shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Submit
                </button>
            </div>
        </div>

        <!-- Section: Are you planning to continue booklogging? -->
        <div id="continueBookloggingSection" class="bg-blue-50 p-6 rounded-lg shadow-md mb-8 flex flex-col items-start">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Are you planning to continue booklegging ?</h3>
            <div class="flex items-center space-x-6 mb-4">
                <label class="inline-flex items-center">
                    <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="continueBooklogging" value="yes" id="continueRadioYes">
                    <span class="ml-2 text-gray-700">Yes</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="continueBooklogging" value="no" id="continueRadioNo">
                    <span class="ml-2 text-gray-700">No</span>
                </label>
            </div>
            <!--<p class="text-gray-600 mb-4">Please make a selection</p>-->
            <!--<div class="self-end">
                <button class="text-blue-600 hover:underline">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </button>
            </div>-->
        </div>

        <!-- Messages for "Are you planning to continue booklogging?" -->
        <div id="continueBookloggingYesMessage" class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-md shadow-md mb-8" role="alert">
            <p class="font-bold">Great!</p>
            <p>We will keep in touch next semester.</p>
        </div>

        <div id="continueBookloggingNoMessage" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md mb-8" role="alert">
            <p class="font-bold">Ok, thank you for your participation so far.</p>
            <p>Please feel free to reach out in future, if interested.</p>
        </div>

         <!-- Submission Success Message -->
        <div id="submissionSuccessMessage" class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-md shadow-md mb-8" role="alert">
            <p class="font-bold">Thank you for your submission.</p>
            <p id="submissionDetails"></p> <!-- This will be populated by JavaScript -->
            <p>We will email you the class assignments for next semester.</p>
        </div>

        <!-- Submission Error Message -->
        <div id="submissionErrorMessage" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md mb-8" role="alert">
            <p class="font-bold">Submission Failed!</p>
            <p id="errorMessageContent"></p>
            <p>Please try again or contact support if the issue persists.</p>
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm mt-8">
            <p>The Booklegger Program is a volunteer effort supported by the Fremont Branch of the Alameda County Library.</p>
            <p>For more information contact : Telephone:(510) 745-1421 Email:fremont.children@aclibrary.org</p>
            <!--<p class="mt-2">
                <a href="#" class="text-blue-600 hover:underline">Newsletter</a> |
                <a href="#" class="text-blue-600 hover:underline">Newsletter archive</a>
            </p>-->
        </footer>

    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-button" id="closeModalBtn">&times;</button>
            <h4 class="text-lg font-semibold mb-2">Additional Comments Information</h4>
            <ul class="list-disc list-inside text-gray-700 space-y-1">
                <li>Comment your date preference, if any</li>
                <li>If you selected 'Other' in grade preference explain here</li>
                <li>Add any other information that you want to let us know</li>
            </ul>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const radioYes = document.getElementById('radioYes');
            const radioNo = document.getElementById('radioNo');
            const availabilitySection = document.getElementById('availabilitySection');
            const continueBookloggingSection = document.getElementById('continueBookloggingSection');

            const continueRadioYes = document.getElementById('continueRadioYes');
            const continueRadioNo = document.getElementById('continueRadioNo');
            const continueBookloggingYesMessage = document.getElementById('continueBookloggingYesMessage');
            const continueBookloggingNoMessage = document.getElementById('continueBookloggingNoMessage');

            const infoIcon = document.getElementById('infoIcon');
            const infoModal = document.getElementById('infoModal');
            const closeModalBtn = document.getElementById('closeModalBtn');

            const submitAvailabilityBtn = document.getElementById('submitAvailabilityBtn'); // New: Get the submit button
            const submissionSuccessMessage = document.getElementById('submissionSuccessMessage'); // New: Get the success message div
            const submissionErrorMessage = document.getElementById('submissionErrorMessage'); // New: Error message div
            const submissionDetails = document.getElementById('submissionDetails');

             // Get references to input fields for data collection
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const numClassesSelect = document.getElementById('numClasses');
            const additionalCommentsTextarea = document.getElementById('additionalComments');
            const gradeCheckboxes = document.querySelectorAll('#availabilitySection input[type="checkbox"]'); // Get all checkboxes
            const backLink = document.getElementById('backLink'); // Get the back link
            const availabilityPrompt = document.getElementById('availabilityPrompt'); // Get the availability prompt text
            const bookloggerInfoForm = document.getElementById('bookloggerInfoForm'); // Get the booklogger information form

            const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyHMvQOo9ol4wOPdwYMVbsBHVUX-IM5Z5wpc8goiXdMjO1zlPW5ye_EFO2NU3J5nk8vnA/exec';


            // Function to manage visibility of main sections based on "Are you booklogging next semester?" selection
            function toggleMainSectionsVisibility() {
                if (radioYes.checked) {
                    availabilitySection.style.display = 'block';
                    continueBookloggingSection.style.display = 'none';
                    // Hide messages when main sections change
                    continueBookloggingYesMessage.style.display = 'none';
                    continueBookloggingNoMessage.style.display = 'none';
                    submissionSuccessMessage.style.display = 'none';
                    submissionErrorMessage.style.display = 'none';
                    
                } else if (radioNo.checked) {
                    availabilitySection.style.display = 'none';
                    continueBookloggingSection.style.display = 'block';
                    // Reset continue booklogging radios and messages when 'No' is clicked
                    if (continueRadioYes) continueRadioYes.checked = false;
                    if (continueRadioNo) continueRadioNo.checked = false;
                    toggleContinueBookloggingMessages(); // Ensure messages are hidden
                } else {
                    // Hide both if neither is selected (e.g., on initial load if no default)
                    availabilitySection.style.display = 'none';
                    continueBookloggingSection.style.display = 'none';
                    continueBookloggingYesMessage.style.display = 'none';
                    continueBookloggingNoMessage.style.display = 'none';
                }
            }

            // Function to manage visibility of messages based on "Are you planning to continue booklogging?" selection
            function toggleContinueBookloggingMessages() {
                // Hide all message when continue booklogging radio changes
                
                submissionSuccessMessage.style.display = 'none';
                submissionErrorMessage.style.display = 'none';
                if (continueRadioYes.checked) {
                    continueBookloggingYesMessage.style.display = 'block';
                    continueBookloggingNoMessage.style.display = 'none';
                } else if (continueRadioNo.checked) {
                    continueBookloggingYesMessage.style.display = 'none';
                    continueBookloggingNoMessage.style.display = 'block';
                } else {
                    continueBookloggingYesMessage.style.display = 'none';
                    continueBookloggingNoMessage.style.display = 'none';
                }
            }

            // Function to reset the form to its initial empty state
            function resetForm() {
                // Clear input fields
                nameInput.value = '';
                emailInput.value = '';
                additionalCommentsTextarea.value = '';

                // Uncheck radio buttons
                if (radioYes) radioYes.checked = false;
                if (radioNo) radioNo.checked = false;
                if (continueRadioYes) continueRadioYes.checked = false;
                if (continueRadioNo) continueRadioNo.checked = false;

                // Uncheck all grade preference checkboxes
                gradeCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });

                // Reset select dropdown
                numClassesSelect.value = ''; // Set to the value of the "Select grade" option, which is empty

                // Hide all dynamic sections and messages
                availabilitySection.style.display = 'none';
                continueBookloggingSection.style.display = 'none';
                continueBookloggingYesMessage.style.display = 'none';
                continueBookloggingNoMessage.style.display = 'none';
                submissionSuccessMessage.style.display = 'none';
                submissionErrorMessage.style.display = 'none';

                // Ensure the submit button is reset to its default state
                submitButtonText.classList.remove('hidden');
                submitButtonLoader.classList.add('hidden');
                submitAvailabilityBtn.disabled = false;
                submitAvailabilityBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }

            // Add event listeners to the main radio buttons
            if (radioYes) {
                radioYes.addEventListener('change', toggleMainSectionsVisibility);
            }
            if (radioNo) {
                radioNo.addEventListener('change', toggleMainSectionsVisibility);
            }

            // Add event listeners to the "continue booklogging" radio buttons
            if (continueRadioYes) {
                continueRadioYes.addEventListener('change', toggleContinueBookloggingMessages);
            }
            if (continueRadioNo) {
                continueRadioNo.addEventListener('change', toggleContinueBookloggingMessages);
            }

            // Event listener for the "Submit" button in the availability section
            if (submitAvailabilityBtn) {
                submitAvailabilityBtn.addEventListener('click', async function() { // Added 'async' keyword
                    // Hide any previous messages
                    submissionSuccessMessage.style.display = 'none';
                    submissionErrorMessage.style.display = 'none';

                    // Gather data from the form
                    const name = nameInput.value;
                    const email = emailInput.value;
                    const selectedGrades = Array.from(document.querySelectorAll('#availabilitySection input[type="checkbox"]:checked'))
                                                .map(cb => cb.value)
                                                .join(', ');
                    const numClasses = numClassesSelect.value;
                    const comments = additionalCommentsTextarea.value;

                    // Construct the data payload for the Google Apps Script
                    const formData = {
                        name: name,
                        email: email,
                        grades: selectedGrades,
                        numClasses: numClasses,
                        comments: comments
                    };

                    try {
                        const response = await fetch(GAS_WEB_APP_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {
                                'Content-Type': 'application/json',
                                // No 'Access-Control-Allow-Origin' header needed here,
                                // it's handled by the server (GAS deployment settings).
                            },
                            body: JSON.stringify(formData),
                        });

                        //const result = await response.json(); // Assuming GAS returns JSON

                        //if (result.status === 'success') {
                            // Construct the detailed message for success
                            let detailsHtml = `
                                <p><strong>Name:</strong> ${name || 'N/A'}</p>
                                <p><strong>Email:</strong> ${email || 'N/A'}</p>
                                <p><strong>Grades Selected:</strong> ${selectedGrades || 'None'}</p>
                                <p><strong>Number of Classes:</strong> ${numClasses || 'N/A'}</p>
                                <p><strong>Additional Comments:</strong> ${comments || 'None'}</p>
                            `;
                            submissionDetails.innerHTML = detailsHtml;
                            availabilitySection.style.display = 'none'; // Hide the form
                            submissionSuccessMessage.style.display = 'block'; // Show success message
                       // } else {
                            // Handle error response from GAS
                           // errorMessageContent.textContent = result.message || 'An unknown error occurred on the server.';
                            //submissionErrorMessage.style.display = 'block'; // Show error message
                       // }
                    } catch (error) {
                        // Handle network errors or issues with the fetch request itself
                        console.error('Fetch error:', error);
                        errorMessageContent.textContent = `Network error or server unreachable: ${error.message}`;
                        submissionErrorMessage.style.display = 'block'; // Show error message
                    }
                });
            }

            // Event listener for the "Back" link
            if (backLink) {
                backLink.addEventListener('click', function(event) {
                    event.preventDefault(); // Prevent default link behavior (page reload)
                    resetForm(); // Call the reset function
                });
            }

            // Event listener for the "Please mark your availability..." prompt
            if (availabilityPrompt && bookloggerInfoForm) {
                availabilityPrompt.addEventListener('click', function() {
                    bookloggerInfoForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            }

            // Event listeners for the info modal
            if (infoIcon) {
                infoIcon.addEventListener('click', function() {
                    infoModal.style.display = 'flex'; // Show the modal
                });
            }

            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', function() {
                    infoModal.style.display = 'none'; // Hide the modal
                });
            }

            // Close modal if clicked outside content
            if (infoModal) {
                infoModal.addEventListener('click', function(event) {
                    if (event.target === infoModal) {
                        infoModal.style.display = 'none';
                    }
                });
            }

            // Initial checks to set the correct visibility on page load
            toggleMainSectionsVisibility();
            toggleContinueBookloggingMessages(); // Call this to set initial state for messages
        });
    </script>
</body>
</html>

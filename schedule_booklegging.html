<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booklegger Scheduling</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        /* Style for date input to ensure consistent height with other inputs */
        input[type="date"] {
            min-height: 42px; /* Adjust as needed to match other inputs' height */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8">

    <!-- Top Navigation Bar -->
    <header class="w-full bg-white shadow-sm py-4 px-6 flex justify-between items-center fixed top-0 z-10">
        <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1_0_01-1 1h-3m-6 0a1 1_0_001 1h3v-9a1 1_0_011-1h2a1 1_0_011 1v9h3a1 1_0_001-1v-9m-9 0h.01"></path>
            </svg>
            <span class="text-gray-700 font-medium">Home</span>
        </div>
        <nav class="flex items-center space-x-6">
            <a href="#" class="text-blue-600 hover:underline font-medium">For Booklegger</a>
            <a href="#" class="text-gray-700 hover:underline">For Librarian</a>
            <a href="index.html" class="text-gray-700 hover:underline">Submit books presented</a>
            <!--<a href="#" class="text-gray-700 hover:underline">Help</a>-->
            <!--<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>-->
        </nav>
    </header>

    <!-- Main Content Area -->
    <div class="container mx-auto mt-20 px-4 max-w-4xl">

        <!-- Booklegger Logo and Search -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8 flex flex-col md:flex-row items-center justify-between">
            <img src="booklegger image.jpeg" alt="Booklegger Logo" class="mb-4 md:mb-0 md:mr-6 rounded-lg">
            <div class="flex items-center border border-gray-300 rounded-md overflow-hidden w-full md:w-auto">
                <input type="text" placeholder="Search here" class="px-4 py-2 flex-grow focus:outline-none text-gray-700">
                <button class="bg-gray-100 p-2 border-l border-gray-300 hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Schedule Booklogger Visit Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="flex items-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <h2 class="text-2xl font-semibold text-gray-800">Schedule a booklegger visit</h2>
            </div>
            <p class="text-gray-600 mb-4">Once you receive your school and grade assignment to your email, it's time to schedule your visit to school. Please follow the steps below.</p>
            <p class="text-gray-600">When you're done entering the details, click 'Export to Excel' button to get a excel sheet file populated with your details.</p>
        </div>

        <!-- Back Button -->
        <div class="mb-6">
            <a href="#" class="text-blue-600 hover:underline flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back
            </a>
        </div>

        <!-- Booklogger Information Form -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Booklegger information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-center">
                    <label for="name" class="w-24 text-gray-700">Name</label>
                    <input type="text" id="bookloggerName" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div class="flex items-center">
                    <label for="email" class="w-24 text-gray-700">Email</label>
                    <input type="email" id="bookloggerEmail" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div class="flex items-center col-span-1 md:col-span-2">
                    <label for="contact" class="w-24 text-gray-700">Contact</label>
                    <input type="text" id="bookloggerContact" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
            </div>
        </div>

        <!-- Select Your Assigned School -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <p class="text-gray-600 mb-4">Select the school you have been assigned. Click <a href="#" class="text-blue-600 hover:underline">here</a> to see class assignments.</p>
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Select your assigned school</h3>
            <div class="flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-4">
                <select id="schoolSelect" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 w-full md:w-auto">
                    <option value="">Select school</option>
                    <option value="School A">School A</option>
                    <option value="School B">School B</option>
                    <option value="School C">School C</option>
                </select>
                <button class="text-blue-600 hover:underline whitespace-nowrap">Click here to check bell schedule</button>
            </div>
        </div>

        <!-- Enter your preferred Start time, Date of presentation and Grade -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Enter your preferred Start time, Date of presentation and Grade</h3>
                <button id="addRowBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Add new row
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-2 text-left text-gray-600 font-semibold">Date</th>
                            <th class="px-4 py-2 text-left text-gray-600 font-semibold">Time</th>
                            <th class="px-4 py-2 text-left text-gray-600 font-semibold">Grade</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <!-- Initial row -->
                        <tr>
                            <td class="px-4 py-2 border-t border-gray-200">
                                <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                                    <input type="date" class="date-input px-3 py-2 flex-grow focus:outline-none text-gray-700">
                                </div>
                            </td>
                            <td class="px-4 py-2 border-t border-gray-200">
                                <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                                    <input type="text" placeholder="00 : 00" class="start-time-input px-3 py-2 w-24 text-center focus:outline-none text-gray-700">
                                    <span class="px-2 text-gray-500">to</span>
                                    <input type="text" placeholder="00 : 00" class="end-time-input px-3 py-2 w-24 text-center focus:outline-none text-gray-700">
                                </div>
                            </td>
                            <td class="px-4 py-2 border-t border-gray-200">
                                <select class="grade-select border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 w-full">
                                    <option value="">Select grade</option>
                                    <option value="Kindergarten">Kindergarten</option>
                                    <option value="1st Grade">1st Grade</option>
                                    <option value="2nd Grade">2nd Grade</option>
                                    <option value="3rd Grade">3rd Grade</option>
                                    <option value="4th Grade">4th Grade</option>
                                    <option value="5th Grade">5th Grade</option>
                                </select>
                            </td>
                            <!--<td class="px-4 py-2 border-t border-gray-200">
                                <input type="text" placeholder="Room" class="room-input border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 w-full">
                            </td>
                            <td class="px-4 py-2 border-t border-gray-200">
                                <input type="text" placeholder="Teacher" class="teacher-input border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 w-full">
                            </td>
                            <td class="px-4 py-2 border-t border-gray-200">
                                <input type="text" placeholder="Comments" class="comments-input border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 w-full">
                            </td>-->
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export to Sheets Button -->
        <div class="text-center mb-8">
            <button id="exportToSheetsBtn" class="bg-blue-600 text-white px-8 py-3 rounded-md shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Export to Sheets
            </button>
        </div>

        <!-- Upcoming Meetings & Booklogger Training -->
       <!-- <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Upcoming Meetings (Fukaya Room, Fremont Main Library)</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li><span class="font-medium">Book Talk Practice Session:</span> Wednesday, June 25, 2025, 11 am - 1 pm</li>
                    <li><span class="font-medium">Book Talk Practice Session:</span> Wednesday, July 30, 2025, 11 am - 1 pm</li>
                    <li><span class="font-medium">Booklegger Ambassadors Organization Training:</span> Wednesday, June 4, 2025 2-4 pm</li>
                </ul>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Booklegger training (Fukaya Room, Fremont Main Library)</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li><span class="font-medium">Orientation:</span> Wednesday, August 20, 11 am - 1 pm</li>
                    <li><span class="font-medium">Training #1:</span> Wednesday, September 10, 11 am - 1 pm</li>
                    <li><span class="font-medium">Training #2:</span> Wednesday, September 24, 11 am - 1 pm</li>
                    <li><span class="font-medium">Training #3:</span> Wednesday, October 1, 11 am - 1 pm</li>
                    <li><span class="font-medium">Meet Your Mentor (Mentor Assignments):</span> Wednesday, October 8, 11 am - 1 pm</li>
                </ul>
            </div>
        </div>-->

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm mt-8">
            <p>The Booklegger Program is a volunteer effort supported by the Fremont Branch of the Alameda County Library.</p>
            <p>For more information contact : Telephone:(510) 745-1421 Email:fremont.children@aclibrary.org</p>
            <!--<p class="mt-2">
                <a href="#" class="text-blue-600 hover:underline">Newsletter</a> |
                <a href="#" class="text-blue-600 hover:underline">Newsletter archive</a>
            </p>-->
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scheduleTableBody = document.getElementById('scheduleTableBody');
            const addRowBtn = document.getElementById('addRowBtn');
            const exportToSheetsBtn = document.getElementById('exportToSheetsBtn');

            // Function to add event listeners for time auto-population to a given row
            function setupTimeAutoPopulation(row) {
                const startTimeInput = row.querySelector('.start-time-input');
                const endTimeInput = row.querySelector('.end-time-input');

                if (startTimeInput && endTimeInput) {
                    startTimeInput.addEventListener('input', function() {
                        let timeStr = this.value.trim();
                        const timeRegex = /^(\d{1,2})\s*:\s*(\d{2})$/;
                        const match = timeStr.match(timeRegex);

                        if (match) {
                            let hours = parseInt(match[1], 10);
                            let minutes = parseInt(match[2], 10);

                            if (hours >= 0 && hours <= 23 && minutes >= 0 && minutes <= 59) {
                                let newMinutes = minutes + 30;
                                let newHours = hours;

                                if (newMinutes >= 60) {
                                    newHours += Math.floor(newMinutes / 60);
                                    newMinutes %= 60;
                                }

                                if (newHours >= 24) {
                                    newHours %= 24;
                                }

                                const formattedNewHours = String(newHours).padStart(2, '0');
                                const formattedNewMinutes = String(newMinutes).padStart(2, '0');
                                endTimeInput.value = `${formattedNewHours} : ${formattedNewMinutes}`;
                            } else {
                                endTimeInput.value = '';
                            }
                        } else {
                            endTimeInput.value = '';
                        }
                    });
                }
            }

            // Setup for the initial row
            setupTimeAutoPopulation(scheduleTableBody.querySelector('tr'));

            // Add new row functionality
            addRowBtn.addEventListener('click', function() {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td class="px-4 py-2 border-t border-gray-200">
                        <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                            <input type="date" class="date-input px-3 py-2 flex-grow focus:outline-none text-gray-700">
                        </div>
                    </td>
                    <td class="px-4 py-2 border-t border-gray-200">
                        <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                            <input type="text" placeholder="00 : 00" class="start-time-input px-3 py-2 w-24 text-center focus:outline-none text-gray-700">
                            <span class="px-2 text-gray-500">to</span>
                            <input type="text" placeholder="00 : 00" class="end-time-input px-3 py-2 w-24 text-center focus:outline-none text-gray-700">
                        </div>
                    </td>
                    <td class="px-4 py-2 border-t border-gray-200">
                        <select class="grade-select border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 w-full">
                            <option value="">Select grade</option>
                            <option value="Kindergarten">Kindergarten</option>
                            <option value="1st Grade">1st Grade</option>
                            <option value="2nd Grade">2nd Grade</option>
                            <option value="3rd Grade">3rd Grade</option>
                            <option value="4th Grade">4th Grade</option>
                            <option value="5th Grade">5th Grade</option>
                        </select>
                    </td>
                `;
                scheduleTableBody.appendChild(newRow);
                setupTimeAutoPopulation(newRow); // Setup time auto-population for the new row
            });

            // Export to Sheets functionality
            exportToSheetsBtn.addEventListener('click', function() {
                const schoolName = document.getElementById('schoolSelect').value;
                const bookloggerName = document.getElementById('bookloggerName').value;
                const bookloggerContact = document.getElementById('bookloggerContact').value;
                const bookloggerEmail = document.getElementById('bookloggerEmail').value;

                let csvContent = "";

                // Top section of the sheet
                csvContent += `"School","${schoolName}",,"Booklegger:","${bookloggerName}"\n`;
                // Collect all grades from the table for the "Grades" field
                const gradeElements = document.querySelectorAll('.grade-select');
                const uniqueGrades = new Set(); // Use a Set to store unique grades
                Array.from(gradeElements)
                    .map(select => select.value)
                    .filter(value => value !== "") // Filter out empty values (e.g., "Select grade")
                    .forEach(value => uniqueGrades.add(value)); // Add unique values to the Set

                const gradesSelected = Array.from(uniqueGrades).join(', '); // Convert Set back to array and join
                csvContent += `"Grades","${gradesSelected}",,"","${bookloggerContact}"\n`;
                csvContent += `",",",",,"","${bookloggerEmail}"\n`;
                csvContent += `\n`; // Empty row for spacing

                csvContent += `"Please sign up for a 30 minute time slot for your Booklegger visit."\n`;
                csvContent += `"If you have changes after 10/30 please contact me directly."\n`;
                csvContent += `\n`; // Empty row for spacing

                // Table headers - Updated to include "Time Slot"
                csvContent += `"Date and Day","Time Slot","Grade","Room Number","Teacher Name","Comments"\n`;

                // Iterate over each row in the schedule table
                const rows = scheduleTableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    const dateInput = row.querySelector('.date-input');
                    const startTimeInput = row.querySelector('.start-time-input');
                    const endTimeInput = row.querySelector('.end-time-input');
                    const gradeSelect = row.querySelector('.grade-select');
                    const roomInput = row.querySelector('.room-input');
                    const teacherInput = row.querySelector('.teacher-input');
                    const commentsInput = row.querySelector('.comments-input');

                    const date = dateInput ? dateInput.value : '';
                    const startTime = startTimeInput ? startTimeInput.value : '';
                    const endTime = endTimeInput ? endTimeInput.value : '';
                    const grade = gradeSelect ? gradeSelect.value : '';
                    const roomNumber = roomInput ? roomInput.value : '';
                    const teacherName = teacherInput ? teacherInput.value : '';
                    const comments = commentsInput ? commentsInput.value : '';

                    // Format date for the sheet
                    let displayDate = date;
                    if (date) {
                        const dateObj = new Date(date);
                        // Example: "Wednesday, July 1, 2025"
                        displayDate = dateObj.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    }
                    const timeSlot = `${startTime} to ${endTime}`;

                    // Add data row - Updated to separate date and time slot
                    csvContent += `"${displayDate}","${timeSlot}","${grade}","${roomNumber}","${teacherName}","${comments}"\n`;
                });

                // Create a Blob from the CSV content
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

                // Create a link element
                const link = document.createElement('a');
                if (link.download !== undefined) { // Feature detection for download attribute
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    // Use the schoolName for the filename, replacing spaces with underscores for better file naming
                    const fileName = schoolName ? `${schoolName.replace(/\s+/g, '_')}_Schedule.csv` : 'Booklogger_Schedule.csv';
                    link.setAttribute('download', fileName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    // Fallback for browsers that don't support the download attribute
                    console.error("Your browser does not support the download attribute. Please right-click and 'Save Link As...'");
                    // You might want to provide a more user-friendly message or a simple text area
                    // where they can copy the CSV content.
                }
            });
        });
    </script>
</body>
</html>
